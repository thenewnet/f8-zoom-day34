<html>

<head>
    <title>Day 34 - Comments App</title>
    <link rel="stylesheet" href="comments-style.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
    <div id="root" className="wrapper"></div>

    <script type="text/babel">
        function Comments() {
            const [comments, setComments] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [newComment, setNewComment] = React.useState('');

            const timeArray = ["2 giờ trước", "1 ngày trước"];

            React.useEffect(() => {
                fetch('https://jsonplaceholder.typicode.com/comments?postId=1')
                    .then(response => response.json())
                    .then(data => {
                        setComments(data.map((comment) => {
                            return {
                                ...comment,
                                time: timeArray[Math.floor(Math.random() * timeArray.length)]
                            }
                        }));
                    })
                    .finally(() => {
                        setLoading(false);
                    });
            }, []);

            const handleAddComment = () => {
                newComment.trim() && setComments([
                    {
                        id: comments.length + 1,
                        name: 'TrungBQ',
                        email: 'trungbqf8@fullstack.edu.vn',
                        body: newComment,
                        time: '1 phút trước'
                    },
                    ...comments
                ]);
                setNewComment('');
            }

            return (
                <>
                    {
                        loading ? <p>Loading...</p> : (
                            <>
                                <div className="comment-wrapper">

                                    <div className="comment-input">
                                        <img
                                            src="https://i.pravatar.cc/40"
                                            alt="avatar"
                                            className="avatar"
                                        />
                                        <div className="input-box">
                                            <textarea
                                                className="textarea"
                                                placeholder="Post your reply"
                                                rows={2}
                                                value={newComment}
                                                onChange={(e) => setNewComment(e.target.value)}
                                            />
                                            <button className="reply-btn" onClick={handleAddComment}>
                                                Reply
                                            </button>
                                        </div>
                                    </div>

                                    <div className="comments-list">
                                        {comments.map((c) => (
                                            <div key={c.id} className="comment-item">
                                                <img
                                                    src={`https://ui-avatars.com/api/?name=${c.name}&background=random`}
                                                    alt="avatar"
                                                    className="avatar"
                                                />
                                                <div className="comment-body">
                                                    <div className="comment-header">
                                                        <span className="name">{c.name}</span>
                                                        <span className="email">{c.email}</span>
                                                        <span className="time">· {c.time}</span>
                                                    </div>
                                                    <p className="content">{c.body}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )
                    }

                </>

            );
        }

        const app = (
            <>
                <h1><a href="index.html"><i className="fa fa-home"></i></a> Comments App</h1>
                <Comments />
            </>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(app);

    </script>


</body>

</html>